# ポケモン戦闘における「優先度」仕様書

## 優先度決定(通常フロー)

```mermaid
flowchart TD
    A[ターン開始] --> B[メガシンカ発生?]
    B -->|Yes| B1{世代は？}
    B1 -->|第6世代| B2[メガ前の特性で優先度決定]
    B1 -->|第7以降| B3[メガ後の特性で優先度決定]
    B -->|No| C[通常優先度を使用]

    B2 --> D
    B3 --> D
    C --> D

    D[優先度により行動順リスト作成] --> E[優先度+すばやさで並び替え]
    E --> F{優先度に影響する効果あり?}

    F -->|Yes| G[特殊効果フローへ]
    F -->|No| H[並び替え順で行動実行]

    G --> G1{効果の種類}
    G1 -->|おさきにどうぞ| G2[対象を直後に移動]
    G1 -->|さきおくり| G3[対象を最後に移動]
    G1 -->|りんしょう/合体技| G4[後のポケモンを直後に移動]
    G1 -->|さいはい| G5[前回の技をそのまま再実行（元の優先度を使用）]
    G1 -->|トラップシェル成功| G6[敵の物理技直後に行動]

    G2 --> H
    G3 --> H
    G4 --> H
    G5 --> H
    G6 --> H
```

## 優先度決定(特例)

### メガシンカ時

- 第6世代；メガシンカ前の特性が優先度に影響
- 第7世代以降；メガシンカ後の特性が即座に反映

### アンコール時

- 優先度は「そのターンの技」で固定される
- アンコールされる前に選んでいた技の優先度が一部反映されるケースあり

### 特殊効果による行動への影響

| 効果          | 行動順への影響       |
|-------------|---------------|
| おさきにどうぞ     | 対象が即座に行動      |
| さきおくり       | 対象が行動順最後に     |
| りんしょう / 合体技 | 味方の後に即行動      |
| トラップシェル成功   | 敵の攻撃直後に行動     |
| さいはい        | 技の優先度を使用して再行動 |

### 優先度に関係のない行動順変化

- せんせいのツメ／クイックドロウ／イバンのみ：行動順が早くなるが優先度変化なし
- こうこうのしっぽ／まんぷくおこう／あとだし／きんしのちから：行動順が遅くなるが優先度変化なし
- じょうおうのいげん／ファストガード／サイコフィールド：優先度+1以上でなければ無効化されない